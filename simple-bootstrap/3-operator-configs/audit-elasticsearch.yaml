---
apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: audit-elasticsearch 
  namespace: openshift-logging
  annotations:
    config.example.com/managed-by: gitops
    config.example.com/scm-url: git@github.com:redhat-cop/declarative-openshift.git
  labels:
    config.example.com/component: operator-configs
    config.example.com/name: simple-bootstrap
spec:
  version: 7.8.0
  nodeSets:
  - name: default
    count: 1
    config:
      node.master: true
      node.data: true
      node.ingest: true
      node.store.allow_mmap: false
  http:
    tls:
      certificate:
        secretName: audit-elasticsearch-fluentd-certs
---
apiVersion: route.openshift.io/v1
kind: Route
metadata:
  name: audit-elasticsearch 
  namespace: openshift-logging
  annotations:
    config.example.com/managed-by: gitops
    config.example.com/scm-url: git@github.com:redhat-cop/declarative-openshift.git
  labels:
    config.example.com/component: operator-configs
    config.example.com/name: simple-bootstrap
spec:
  tls:
    termination: passthrough # Elasticsearch is the TLS endpoint
    insecureEdgeTerminationPolicy: Redirect
  to:
    kind: Service
    name: audit-elasticsearch-es-http
